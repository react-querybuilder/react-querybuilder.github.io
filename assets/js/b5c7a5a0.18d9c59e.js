"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5249],{70992:(e,t,n)=>{n.d(t,{c:()=>i});var a=n(42349),r=n(44561),s=n(27378),o=n(24246);const i=e=>{let{children:t,customSetup:n,options:i,rqbVersion:d=6}=e;const l="dark"===(0,r.I)().colorMode,c=s.Children.toArray(t),p=l?"#343a46":"#ffffff";let u=!0;const m={};for(const a of c){const{props:e}=a.props.children;let t,n=!1,r=!1;if(e.metastring){const[a,...s]=e.metastring.split(" ");t="/"+a,n=s.includes("hidden"),r=s.includes("active")}else if("language-tsx"===e.className)t="/App.tsx";else if("language-js"===e.className)t="/App.js";else{if("language-css"!==e.className)throw new Error(`Code block is missing a filename: ${e.children}`);t="/styles.css"}if(m[t])throw new Error(`File ${t} was defined multiple times. Each file snippet should have a unique path name.`);"/styles.css"!==t||n||(u=!1),m[t]={code:e.children,hidden:n,active:r}}const h=RegExp("^import +'react-querybuilder/dist/query-builder\\.s?css';?$").test(m["/App.tsx"]?.code)?"":"@import 'react-querybuilder/dist/query-builder.css';",f=`\nbody {\n  background-color: ${p};\n}\npre {\n  padding: 1rem;\n  background-color: white;\n  border: 1px solid lightgray;\n  border-radius: 0.25rem;\n  white-space: pre-wrap;\n}\n${l?"\nh1, h2, h3, h4, h5, h6 {\n  color: white;\n}":""}`;m["/styles.css"]={code:[h,f,m["/styles.css"]?.code??""].join("\n\n"),hidden:u};const y=4===d?{"react-querybuilder":"^4.5.3"}:5===d?{"@react-querybuilder/dnd":"^5.4.1","react-querybuilder":"^5.4.1"}:{"@react-querybuilder/dnd":"^6.0.7","react-querybuilder":"^6.0.7"},g={...n,dependencies:{...n?.dependencies,...y}};return(0,o.jsx)("div",{className:"sandpackrqb",children:(0,o.jsx)(a.xR,{files:m,theme:l?"dark":void 0,template:"vite-react-ts",customSetup:g,options:i})},`v${d}`)}},73908:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>c});var a=n(24246),r=n(71670),s=n(70992);const o={title:"Custom components with fallbacks",description:"Augmenting the default components",hide_table_of_contents:!0},i=void 0,d={id:"tips/custom-with-fallback",title:"Custom components with fallbacks",description:"Augmenting the default components",source:"@site/versioned_docs/version-4/tips/custom-with-fallback.mdx",sourceDirName:"tips",slug:"/tips/custom-with-fallback",permalink:"/docs/4/tips/custom-with-fallback",draft:!1,unlisted:!1,editUrl:"https://github.com/react-querybuilder/react-querybuilder/edit/main/website/versioned_docs/version-4/tips/custom-with-fallback.mdx",tags:[],version:"4",frontMatter:{title:"Custom components with fallbacks",description:"Augmenting the default components",hide_table_of_contents:!0},sidebar:"mySidebar",previous:{title:"Limit rule groups",permalink:"/docs/4/tips/limit-groups"},next:{title:"External controls",permalink:"/docs/4/tips/external-controls"}},l={},c=[];function p(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["You may run into a situation where one of the default components ",(0,a.jsx)(t.em,{children:"almost"})," meets your requirements, but you don't want to recreate the entire component just to slightly modify the behavior. Falling back to the default component after implementing your custom behavior is a good way to keep your implementation up to date with the current version's standard features while retaining the flexibility of a fully custom solution."]}),"\n",(0,a.jsxs)(t.p,{children:["For example, let's say you need a value editor that presents the user with a date picker (not the browser's default date picker), but only for certain fields. The default ",(0,a.jsx)(t.code,{children:"ValueEditor"})," does not implement a date picker, so you'll need to use a custom component."]}),"\n",(0,a.jsxs)(t.p,{children:["However, you don't need to copy/paste the default ",(0,a.jsx)(t.code,{children:"ValueEditor"})," code to take advantage of its functionality. Simply spread the same props that were passed in to your custom component (",(0,a.jsx)(t.code,{children:"<ValueEditor {...props} />"}),") and return that if your custom behavior is not applicable."]}),"\n",(0,a.jsxs)(t.p,{children:["Let's create a custom value editor that uses the ",(0,a.jsx)(t.a,{href:"https://reactdatepicker.com/",children:(0,a.jsx)(t.code,{children:"react-datepicker"})})," library. First we'll set up the ",(0,a.jsx)(t.code,{children:"fields"})," array. Each element is a standard ",(0,a.jsx)(t.code,{children:"Field"})," object, but the two date-type fields have a special attribute called ",(0,a.jsx)(t.code,{children:"datatype"})," that will let our custom value editor know when and how to display the date picker."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:"// fields.ts\nimport { Field } from 'react-querybuilder';\n\nexport const fields: Field[] = [\n  {\n    name: 'name',\n    label: 'Name',\n    operators: [\n      { name: '=', label: 'is' },\n      { name: 'beginsWith', label: 'begins with' },\n    ],\n  },\n  {\n    name: 'dateOfBirth',\n    label: 'Date of Birth',\n    operators: [{ name: '=', label: 'is' }],\n    datatype: 'date',\n  },\n  {\n    name: 'dateRange',\n    label: 'Date Range',\n    operators: [{ name: 'between', label: 'is between' }],\n    datatype: 'dateRange',\n  },\n];\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Next, we'll define the custom value editor. The component will display a standard date picker if the ",(0,a.jsx)(t.code,{children:"datatype"})," for the field is ",(0,a.jsx)(t.code,{children:'"date"'}),", and a date ",(0,a.jsx)(t.em,{children:"range"})," picker if the ",(0,a.jsx)(t.code,{children:"datatype"})," is ",(0,a.jsx)(t.code,{children:'"dateRange"'}),". If the ",(0,a.jsx)(t.code,{children:"datatype"})," is something else or ",(0,a.jsx)(t.code,{children:"undefined"}),", then the component will simply forward its props to the default ",(0,a.jsx)(t.code,{children:"ValueEditor"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["We're also using the ",(0,a.jsx)(t.a,{href:"https://date-fns.org/",children:(0,a.jsx)(t.code,{children:"date-fns"})})," library to help parse and format dates. Storing the date values as strings instead of ",(0,a.jsx)(t.code,{children:"Date"})," objects helps ensure that the ",(0,a.jsx)(t.code,{children:"query"})," object remains serializable in case we want to safely use ",(0,a.jsx)(t.code,{children:"JSON.stringify"}),". (Date ranges are stored as a comma-separated pair of strings.)"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-tsx",children:"// CustomValueEditor.tsx\nimport { format, parse } from 'date-fns';\nimport DatePicker from 'react-datepicker';\nimport 'react-datepicker/dist/react-datepicker.css';\nimport { ValueEditor, ValueEditorProps } from 'react-querybuilder';\n\nconst dateFormat = 'yyyy-MM-dd';\n\nexport const CustomValueEditor = (props: ValueEditorProps) => {\n  if (props.fieldData.datatype === 'date') {\n    return (\n      <div>\n        <DatePicker\n          dateFormat={dateFormat}\n          selected={!props.value ? null : parse(props.value, dateFormat, new Date())}\n          onChange={(d: Date) => props.handleOnChange(d ? format(d, dateFormat) : null)}\n        />\n      </div>\n    );\n  } else if (props.fieldData.datatype === 'dateRange') {\n    const [startDate, endDate] = props.value.split(',');\n    return (\n      <div>\n        <DatePicker\n          selectsRange\n          dateFormat={dateFormat}\n          startDate={!startDate ? null : parse(startDate, dateFormat, new Date())}\n          endDate={!endDate ? null : parse(endDate, dateFormat, new Date())}\n          onChange={(update: [Date, Date]) => {\n            const [s, e] = update;\n            props.handleOnChange(\n              [!s ? '' : format(s, dateFormat), !e ? '' : format(e, dateFormat)].join(',')\n            );\n          }}\n        />\n      </div>\n    );\n  }\n  return <ValueEditor {...props} />;\n};\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Finally, we can configure the main ",(0,a.jsx)(t.code,{children:"QueryBuilder"})," component to use our custom value editor with the ",(0,a.jsx)(t.code,{children:"controlElements"})," prop."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-tsx",children:"// App.tsx\nimport { useState } from 'react';\nimport { CustomValueEditor } from './CustomValueEditor';\nimport { fields } from './fields';\n\nexport default function App() {\n  const [query, setQuery] = useState({ combinator: 'and', rules: [] });\n  return (\n    <QueryBuilder\n      fields={fields}\n      query={query}\n      onQueryChange={q => setQuery(q)}\n      // highlight-start\n      controlElements={{ valueEditor: CustomValueEditor }}\n      // highlight-end\n    />\n  );\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:'An interactive demo is below. Note how the "Name" field uses a text input, the "Date of Birth" field uses a standard date picker, and the "Date Range" field uses the date range picker.'}),"\n",(0,a.jsxs)(s.c,{rqbVersion:4,customSetup:{dependencies:{"date-fns":"latest","react-datepicker":"latest"}},options:{editorHeight:690},children:[(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-tsx",children:"import { useState } from 'react';\nimport { QueryBuilder } from 'react-querybuilder';\nimport { CustomValueEditor } from './CustomValueEditor';\nimport { fields } from './fields';\nimport { initialQuery } from './initialQuery';\n\nexport default function App() {\n  const [query, setQuery] = useState(initialQuery);\n  return (\n    <QueryBuilder\n      fields={fields}\n      query={query}\n      onQueryChange={q => setQuery(q)}\n      controlElements={{ valueEditor: CustomValueEditor }}\n    />\n  );\n}\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-tsx",metastring:"CustomValueEditor.tsx active",children:"import { format, parse } from 'date-fns';\nimport DatePicker from 'react-datepicker';\nimport 'react-datepicker/dist/react-datepicker.css';\nimport { ValueEditor, ValueEditorProps } from 'react-querybuilder';\n\nconst dateFormat = 'yyyy-MM-dd';\n\nexport const CustomValueEditor = (props: ValueEditorProps) => {\n  if (props.fieldData.datatype === 'date') {\n    return (\n      <div>\n        <DatePicker\n          dateFormat={dateFormat}\n          selected={!props.value ? null : parse(props.value, dateFormat, new Date())}\n          onChange={(d: Date) => props.handleOnChange(d ? format(d, dateFormat) : null)}\n        />\n      </div>\n    );\n  } else if (props.fieldData.datatype === 'dateRange') {\n    const [startDate, endDate] = props.value.split(',');\n    return (\n      <div>\n        <DatePicker\n          selectsRange\n          dateFormat={dateFormat}\n          startDate={!startDate ? null : parse(startDate, dateFormat, new Date())}\n          endDate={!endDate ? null : parse(endDate, dateFormat, new Date())}\n          onChange={(range: [Date, Date]) => {\n            const [s, e] = range;\n            props.handleOnChange(\n              [!s ? '' : format(s, dateFormat), !e ? '' : format(e, dateFormat)].join(',')\n            );\n          }}\n        />\n      </div>\n    );\n  }\n  return <ValueEditor {...props} />;\n};\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:"fields.ts",children:"import { Field } from 'react-querybuilder';\n\nexport const fields: Field[] = [\n  {\n    name: 'name',\n    label: 'Name',\n    operators: [\n      { name: '=', label: 'is' },\n      { name: 'beginsWith', label: 'begins with' },\n    ],\n  },\n  {\n    name: 'dateOfBirth',\n    label: 'Date of Birth',\n    operators: [{ name: '=', label: 'is' }],\n    datatype: 'date',\n  },\n  {\n    name: 'dateRange',\n    label: 'Date Range',\n    operators: [{ name: 'between', label: 'is between' }],\n    datatype: 'dateRange',\n  },\n];\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:"initialQuery.ts",children:"import { format, subDays } from 'date-fns';\nimport { RuleGroupType } from 'react-querybuilder';\n\nconst initialRange = [subDays(new Date(), 14), new Date()]\n  .map(d => format(d, 'yyyy-MM-dd'))\n  .join(',');\n\nexport const initialQuery: RuleGroupType = {\n  rules: [\n    {\n      field: 'name',\n      operator: '=',\n      value: 'Steve Vai',\n    },\n    {\n      field: 'dateOfBirth',\n      operator: '=',\n      value: '1960-06-06',\n    },\n    {\n      field: 'dateRange',\n      value: initialRange,\n      operator: 'between',\n    },\n  ],\n  combinator: 'and',\n  not: false,\n};\n"})}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-css",children:".react-datepicker-wrapper input {\n  /* Widen the input to show both dates */\n  width: 180px;\n}\n"})})]}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.p,{children:['Other examples of the "fallback" technique can be seen in the ',(0,a.jsx)(t.a,{href:"./limit-groups#conditionally-allow-new-groups",children:"Limit rule groups"})," page and ",(0,a.jsx)(t.a,{href:"https://stackoverflow.com/questions/68447510/react-query-builder-question-is-there-a-way-to-disable-a-field-option-when-addi/69443288#69443288",children:"these"})," ",(0,a.jsx)(t.a,{href:"https://stackoverflow.com/questions/61768845/progamatically-show-hide-operator-rule-and-group-button-in-react-querybuilder/69443467#69443467",children:"two"})," StackOverflow answers."]})})]})}function u(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}}}]);